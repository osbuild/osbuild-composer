{
  "version": "2",
  "mpp-vars": {
    "arch": "x86_64",
    "version": 8.5,
    "relver": "f$version",
    "isolabel": "RHEL-EDGE-$version-X86_64",
    "diskimage": "disk.img.xz"
  },
  "pipelines": [
    {
      "mpp-import-pipeline": {
        "path": "el8-build.json",
        "id": "build"
      },
      "runner": "org.osbuild.rhel85"
    },
    {
      "name": "rootfs",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.kernel-cmdline",
          "options": {
            "root_fs_uuid": "76a22bf4-f153-4541-b6c7-0332c0dfaeac",
            "kernel_opts": "net.ifnames=0 crashkernel=auto"
          }
        },
        {
          "type": "org.osbuild.rpm",
          "options": {
            "gpgkeys": [
              "-----BEGIN PGP PUBLIC KEY BLOCK-----\n\nmQINBF1RVqsBEADWMBqYv/G1r4PwyiPQCfg5fXFGXV1FCZ32qMi9gLUTv1CX7rYy\nH4Inj93oic+lt1kQ0kQCkINOwQczOkm6XDkEekmMrHknJpFLwrTK4AS28bYF2RjL\nM+QJ/dGXDMPYsP0tkLvoxaHr9WTRq89A+AmONcUAQIMJg3JxXAAafBi2UszUUEPI\nU35MyufFt2ePd1k/6hVAO8S2VT72TxXSY7Ha4X2J0pGzbqQ6Dq3AVzogsnoIi09A\n7fYutYZPVVAEGRUqavl0th8LyuZShASZ38CdAHBMvWV4bVZghd/wDV5ev3LXUE0o\nitLAqNSeiDJ3grKWN6v0qdU0l3Ya60sugABd3xaE+ROe8kDCy3WmAaO51Q880ZA2\niXOTJFObqkBTP9j9+ZeQ+KNE8SBoiH1EybKtBU8HmygZvu8ZC1TKUyL5gwGUJt8v\nergy5Bw3Q7av520sNGD3cIWr4fBAVYwdBoZT8RcsnU1PP67NmOGFcwSFJ/LpiOMC\npZ1IBvjOC7KyKEZY2/63kjW73mB7OHOd18BHtGVkA3QAdVlcSule/z68VOAy6bih\nE6mdxP28D4INsts8w6yr4G+3aEIN8u0qRQq66Ri5mOXTyle+ONudtfGg3U9lgicg\nz6oVk17RT0jV9uL6K41sGZ1sH/6yTXQKagdAYr3w1ix2L46JgzC+/+6SSwARAQAB\ntDFGZWRvcmEgKDMyKSA8ZmVkb3JhLTMyLXByaW1hcnlAZmVkb3JhcHJvamVjdC5v\ncmc+iQI4BBMBAgAiBQJdUVarAhsPBgsJCAcDAgYVCAIJCgsEFgIDAQIeAQIXgAAK\nCRBsEwJtEslE0LdAD/wKdAMtfzr7O2y06/sOPnrb3D39Y2DXbB8y0iEmRdBL29Bq\n5btxwmAka7JZRJVFxPsOVqZ6KARjS0/oCBmJc0jCRANFCtM4UjVHTSsxrJfuPkel\nvrlNE9tcR6OCRpuj/PZgUa39iifF/FTUfDgh4Q91xiQoLqfBxOJzravQHoK9VzrM\nNTOu6J6l4zeGzY/ocj6DpT+5fdUO/3HgGFNiNYPC6GVzeiA3AAVR0sCyGENuqqdg\nwUxV3BIht05M5Wcdvxg1U9x5I3yjkLQw+idvX4pevTiCh9/0u+4g80cT/21Cxsdx\n7+DVHaewXbF87QQIcOAing0S5QE67r2uPVxmWy/56TKUqDoyP8SNsV62lT2jutsj\nLevNxUky011g5w3bc61UeaeKrrurFdRs+RwBVkXmtqm/i6g0ZTWZyWGO6gJd+HWA\nqY1NYiq4+cMvNLatmA2sOoCsRNmE9q6jM/ESVgaH8hSp8GcLuzt9/r4PZZGl5CvU\neldOiD221u8rzuHmLs4dsgwJJ9pgLT0cUAsOpbMPI0JpGIPQ2SG6yK7LmO6HFOxb\nAkz7IGUt0gy1MzPTyBvnB+WgD1I+IQXXsJbhP5+d+d3mOnqsd6oDM/grKBzrhoUe\noNadc9uzjqKlOrmrdIR3Bz38SSiWlde5fu6xPqJdmGZRNjXtcyJlbSPVDIloxw==\n=QWRO\n-----END PGP PUBLIC KEY BLOCK-----\n"
            ]
          },
          "inputs": {
            "packages": {
              "type": "org.osbuild.files",
              "origin": "org.osbuild.source",
              "mpp-depsolve": {
                "architecture": "x86_64",
                "module-platform-id": "platform:el8",
                "repos": [
                  {
                    "id": "baseos",
                    "baseurl": "https://rpmrepo.osbuild.org/v2/mirror/rhvpn/el8/el8-x86_64-baseos-n8.5-20210526/"
                  },
                  {
                    "id": "appstream",
                    "baseurl": "https://rpmrepo.osbuild.org/v2/mirror/rhvpn/el8/el8-x86_64-appstream-n8.5-20210526/"
                  }
                ],
                "packages": [
                  "redhat-release",
                  "glibc",
                  "glibc-minimal-langpack",
                  "nss-altfiles",
                  "dracut-config-generic",
                  "dracut-network",
                  "basesystem",
                  "bash",
                  "platform-python",
                  "shadow-utils",
                  "chrony",
                  "setup",
                  "shadow-utils",
                  "sudo",
                  "systemd",
                  "coreutils",
                  "util-linux",
                  "curl",
                  "vim-minimal",
                  "rpm",
                  "rpm-ostree",
                  "polkit",
                  "lvm2",
                  "cryptsetup",
                  "pinentry",
                  "e2fsprogs",
                  "dosfstools",
                  "keyutils",
                  "gnupg2",
                  "attr",
                  "xz",
                  "gzip",
                  "firewalld",
                  "iptables",
                  "NetworkManager",
                  "NetworkManager-wifi",
                  "NetworkManager-wwan",
                  "wpa_supplicant",
                  "dnsmasq",
                  "traceroute",
                  "hostname",
                  "iproute",
                  "iputils",
                  "openssh-clients",
                  "procps-ng",
                  "rootfiles",
                  "openssh-server",
                  "passwd",
                  "policycoreutils",
                  "policycoreutils-python-utils",
                  "selinux-policy-targeted",
                  "setools-console",
                  "less",
                  "tar",
                  "rsync",
                  "fwupd",
                  "usbguard",
                  "bash-completion",
                  "tmux",
                  "ima-evm-utils",
                  "audit",
                  "podman",
                  "container-selinux",
                  "skopeo",
                  "criu",
                  "slirp4netns",
                  "fuse-overlayfs",
                  "clevis",
                  "clevis-dracut",
                  "clevis-luks",
                  "greenboot",
                  "greenboot-grub2",
                  "greenboot-rpm-ostree-grub2",
                  "greenboot-reboot",
                  "greenboot-status",
                  "grub2",
                  "grub2-efi-x64",
                  "efibootmgr",
                  "shim-x64",
                  "microcode_ctl",
                  "iwl1000-firmware",
                  "iwl100-firmware",
                  "iwl105-firmware",
                  "iwl135-firmware",
                  "iwl2000-firmware",
                  "iwl2030-firmware",
                  "iwl3160-firmware",
                  "iwl5000-firmware",
                  "iwl5150-firmware",
                  "iwl6000-firmware",
                  "iwl6050-firmware",
                  "iwl7260-firmware"
                ]
              }
            }
          }
        },
        {
          "type": "org.osbuild.locale",
          "options": {
            "language": "en_US"
          }
        },
        {
          "type": "org.osbuild.ostree.preptree",
          "options": {
            "etc_group_members": [
              "wheel"
            ]
          }
        }
      ]
    },
    {
      "name": "ostree-commit",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.ostree.init",
          "options": {
            "path": "/repo"
          }
        },
        {
          "type": "org.osbuild.ostree.commit",
          "inputs": {
            "tree": {
              "type": "org.osbuild.tree",
              "origin": "org.osbuild.pipeline",
              "references": [
                "name:rootfs"
              ]
            }
          },
          "options": {
            "ref": "rhel/x86_64/osbuild",
            "os_version": "8.5"
          }
        }
      ]
    },
    {
      "name": "image-tree",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.ostree.init-fs"
        },
        {
          "type": "org.osbuild.ostree.pull",
          "options": {
            "repo": "/ostree/repo"
          },
          "inputs": {
            "commits": {
              "type": "org.osbuild.ostree",
              "origin": "org.osbuild.pipeline",
              "references": {
                "name:ostree-commit": {
                  "ref": "rhel/x86_64/osbuild"
                }
              }
            }
          }
        },
        {
          "type": "org.osbuild.ostree.os-init",
          "options": {
            "osname": "redhat"
          }
        },
        {
          "type": "org.osbuild.ostree.config",
          "options": {
            "repo": "/ostree/repo",
            "config": {
              "sysroot": {
                "readonly": true
              }
            }
          }
        },
        {
          "type": "org.osbuild.mkdir",
          "options": {
            "paths": [
              {
                "path": "/boot/efi",
                "mode": 448
              }
            ]
          }
        },
        {
          "type": "org.osbuild.ostree.deploy",
          "options": {
            "osname": "redhat",
            "ref": "rhel/x86_64/osbuild",
            "mounts": [
              "/boot",
              "/boot/efi"
            ],
            "rootfs": {
              "label": "root"
            },
            "kernel_opts": [
              "console=tty0",
              "console=ttyS0",
              "systemd.log_target=console",
              "systemd.journald.forward_to_console=1"
            ]
          }
        },
        {
          "type": "org.osbuild.ostree.fillvar",
          "options": {
            "deployment": {
              "osname": "redhat",
              "ref": "rhel/x86_64/osbuild"
            }
          }
        },
        {
          "type": "org.osbuild.fstab",
          "options": {
            "ostree": {
              "deployment": {
                "osname": "redhat",
                "ref": "rhel/x86_64/osbuild"
              }
            },
            "filesystems": [
              {
                "label": "boot",
                "vfs_type": "ext4",
                "path": "/boot",
                "freq": 1,
                "passno": 1
              },
              {
                "label": "root",
                "vfs_type": "xfs",
                "path": "/",
                "freq": 1,
                "passno": 1
              },
              {
                "label": "ESP",
                "vfs_type": "vfat",
                "path": "/boot/efi",
                "options": "umask=0077,shortname=winnt",
                "freq": 0,
                "passno": 2
              }
            ]
          }
        },
        {
          "type": "org.osbuild.users",
          "options": {
            "ostree": {
              "deployment": {
                "osname": "redhat",
                "ref": "rhel/x86_64/osbuild"
              }
            },
            "users": {
              "root": {
                "password": ""
              }
            }
          }
        },
        {
          "type": "org.osbuild.ostree.selinux",
          "options": {
            "deployment": {
              "osname": "redhat",
              "ref": "rhel/x86_64/osbuild"
            }
          }
        },
        {
          "type": "org.osbuild.grub2",
          "options": {
            "rootfs": {
              "label": "root"
            },
            "bootfs": {
              "label": "boot"
            },
            "uefi": {
              "vendor": "redhat",
              "install": true
            },
            "legacy": "i386-pc",
            "write_defaults": false
          }
        }
      ]
    },
    {
      "name": "image",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.truncate",
          "options": {
            "filename": "disk.img",
            "size": "10737418240"
          }
        },
        {
          "type": "org.osbuild.sfdisk",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img"
              }
            }
          },
          "options": {
            "uuid": "D209C89E-EA5E-4FBD-B161-B461CCE297E0",
            "label": "gpt",
            "partitions": [
              {
                "start": 2048,
                "size": 2048,
                "type": "21686148-6449-6E6F-744E-656564454649",
                "bootable": true,
                "uuid": "FAC7F1FB-3E8D-4137-A512-961DE09A5549"
              },
              {
                "start": 4096,
                "size": 204800,
                "type": "C12A7328-F81F-11D2-BA4B-00A0C93EC93B",
                "uuid": "68B2905B-DF3E-4FB3-80FA-49D1E773AA33"
              },
              {
                "start": 208896,
                "size": 204800,
                "type": "0FC63DAF-8483-4772-8E79-3D69D8477DE4",
                "uuid": "61B2905B-DF3E-4FB3-80FA-49D1E773AA32"
              },
              {
                "start": 413696,
                "size": 20557791,
                "type": "0FC63DAF-8483-4772-8E79-3D69D8477DE4",
                "uuid": "6264D520-3FB9-423F-8AB8-7A0A8E3D3562"
              }
            ]
          }
        },
        {
          "type": "org.osbuild.mkfs.fat",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 4096,
                "size": 204800
              }
            }
          },
          "options": {
            "label": "ESP",
            "volid": "7B7795E7"
          }
        },
        {
          "type": "org.osbuild.mkfs.ext4",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 208896,
                "size": 204800
              }
            }
          },
          "options": {
            "uuid": "156f0420-627b-4151-ae6f-fda298097515",
            "label": "boot"
          }
        },
        {
          "type": "org.osbuild.mkfs.xfs",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 413696,
                "size": 20557791
              }
            }
          },
          "options": {
            "uuid": "76a22bf4-f153-4541-b6c7-0332c0dfaeac",
            "label": "root"
          }
        },
        {
          "type": "org.osbuild.copy",
          "inputs": {
            "tree": {
              "type": "org.osbuild.tree",
              "origin": "org.osbuild.pipeline",
              "references": [
                "name:image-tree"
              ]
            }
          },
          "options": {
            "paths": [
              {
                "from": "input://tree/",
                "to": "mount://root/"
              }
            ]
          },
          "devices": {
            "efi": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 4096,
                "size": 204800
              }
            },
            "boot": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 208896,
                "size": 204800
              }
            },
            "root": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "disk.img",
                "start": 413696,
                "size": 20557791
              }
            }
          },
          "mounts": {
            "root": {
              "type": "org.osbuild.xfs",
              "source": "root",
              "target": "/"
            },
            "boot": {
              "type": "org.osbuild.ext4",
              "source": "boot",
              "target": "/boot"
            },
            "efi": {
              "type": "org.osbuild.fat",
              "source": "efi",
              "target": "/boot/efi"
            }
          }
        },
        {
          "type": "org.osbuild.grub2.inst",
          "options": {
            "platform": "i386-pc",
            "filename": "disk.img",
            "location": 2048,
            "core": {
              "type": "mkimage",
              "partlabel": "gpt",
              "filesystem": "ext4"
            },
            "prefix": {
              "type": "partition",
              "partlabel": "gpt",
              "number": 2,
              "path": "/grub2"
            }
          }
        }
      ]
    },
    {
      "name": "image-xz",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.xz",
          "inputs": {
            "file": {
              "type": "org.osbuild.files",
              "origin": "org.osbuild.pipeline",
              "references": {
                "name:image": {
                  "file": "disk.img"
                }
              }
            }
          },
          "options": {
            "filename": {
              "mpp-format-string": "{diskimage}"
            }
          }
        }
      ]
    },
    {
      "name": "base",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.kernel-cmdline",
          "options": {
            "root_fs_uuid": "76a22bf4-f153-4541-b6c7-0332c0dfaeac",
            "kernel_opts": "net.ifnames=0 crashkernel=auto"
          }
        },
        {
          "type": "org.osbuild.rpm",
          "options": {
            "gpgkeys": [
              "-----BEGIN PGP PUBLIC KEY BLOCK-----\n\nmQINBF1RVqsBEADWMBqYv/G1r4PwyiPQCfg5fXFGXV1FCZ32qMi9gLUTv1CX7rYy\nH4Inj93oic+lt1kQ0kQCkINOwQczOkm6XDkEekmMrHknJpFLwrTK4AS28bYF2RjL\nM+QJ/dGXDMPYsP0tkLvoxaHr9WTRq89A+AmONcUAQIMJg3JxXAAafBi2UszUUEPI\nU35MyufFt2ePd1k/6hVAO8S2VT72TxXSY7Ha4X2J0pGzbqQ6Dq3AVzogsnoIi09A\n7fYutYZPVVAEGRUqavl0th8LyuZShASZ38CdAHBMvWV4bVZghd/wDV5ev3LXUE0o\nitLAqNSeiDJ3grKWN6v0qdU0l3Ya60sugABd3xaE+ROe8kDCy3WmAaO51Q880ZA2\niXOTJFObqkBTP9j9+ZeQ+KNE8SBoiH1EybKtBU8HmygZvu8ZC1TKUyL5gwGUJt8v\nergy5Bw3Q7av520sNGD3cIWr4fBAVYwdBoZT8RcsnU1PP67NmOGFcwSFJ/LpiOMC\npZ1IBvjOC7KyKEZY2/63kjW73mB7OHOd18BHtGVkA3QAdVlcSule/z68VOAy6bih\nE6mdxP28D4INsts8w6yr4G+3aEIN8u0qRQq66Ri5mOXTyle+ONudtfGg3U9lgicg\nz6oVk17RT0jV9uL6K41sGZ1sH/6yTXQKagdAYr3w1ix2L46JgzC+/+6SSwARAQAB\ntDFGZWRvcmEgKDMyKSA8ZmVkb3JhLTMyLXByaW1hcnlAZmVkb3JhcHJvamVjdC5v\ncmc+iQI4BBMBAgAiBQJdUVarAhsPBgsJCAcDAgYVCAIJCgsEFgIDAQIeAQIXgAAK\nCRBsEwJtEslE0LdAD/wKdAMtfzr7O2y06/sOPnrb3D39Y2DXbB8y0iEmRdBL29Bq\n5btxwmAka7JZRJVFxPsOVqZ6KARjS0/oCBmJc0jCRANFCtM4UjVHTSsxrJfuPkel\nvrlNE9tcR6OCRpuj/PZgUa39iifF/FTUfDgh4Q91xiQoLqfBxOJzravQHoK9VzrM\nNTOu6J6l4zeGzY/ocj6DpT+5fdUO/3HgGFNiNYPC6GVzeiA3AAVR0sCyGENuqqdg\nwUxV3BIht05M5Wcdvxg1U9x5I3yjkLQw+idvX4pevTiCh9/0u+4g80cT/21Cxsdx\n7+DVHaewXbF87QQIcOAing0S5QE67r2uPVxmWy/56TKUqDoyP8SNsV62lT2jutsj\nLevNxUky011g5w3bc61UeaeKrrurFdRs+RwBVkXmtqm/i6g0ZTWZyWGO6gJd+HWA\nqY1NYiq4+cMvNLatmA2sOoCsRNmE9q6jM/ESVgaH8hSp8GcLuzt9/r4PZZGl5CvU\neldOiD221u8rzuHmLs4dsgwJJ9pgLT0cUAsOpbMPI0JpGIPQ2SG6yK7LmO6HFOxb\nAkz7IGUt0gy1MzPTyBvnB+WgD1I+IQXXsJbhP5+d+d3mOnqsd6oDM/grKBzrhoUe\noNadc9uzjqKlOrmrdIR3Bz38SSiWlde5fu6xPqJdmGZRNjXtcyJlbSPVDIloxw==\n=QWRO\n-----END PGP PUBLIC KEY BLOCK-----\n"
            ],
            "exclude": {
              "docs": true
            },
            "disable_dracut": true
          },
          "inputs": {
            "packages": {
              "type": "org.osbuild.files",
              "origin": "org.osbuild.source",
              "mpp-depsolve": {
                "architecture": "x86_64",
                "module-platform-id": "platform:el8",
                "repos": [
                  {
                    "id": "baseos",
                    "baseurl": "https://rpmrepo.osbuild.org/v2/mirror/rhvpn/el8/el8-x86_64-baseos-n8.5-20210526/"
                  },
                  {
                    "id": "appstream",
                    "baseurl": "https://rpmrepo.osbuild.org/v2/mirror/rhvpn/el8/el8-x86_64-appstream-n8.5-20210526/"
                  },
                  {
                    "id": "coi-runcom-56",
                    "baseurl": "http://coprbe.devel.redhat.com/results/amurdaca/coreos-installer/rhel-8-x86_64/"
                  }
                ],
                "packages": [
                  "cloud-utils-growpart",
                  "dracut-live",
                  "xfsprogs",
                  "bsdtar",
                  "coreos-installer",
                  "coreos-installer-bootinfra",
                  "dracut-config-generic",
                  "dracut-network",
                  "kernel",
                  "binutils",
                  "basesystem",
                  "sudo",
                  "systemd",
                  "coreutils",
                  "util-linux",
                  "curl",
                  "e2fsprogs",
                  "dosfstools",
                  "attr",
                  "xz",
                  "gzip",
                  "iptables",
                  "dnsmasq",
                  "traceroute",
                  "hostname",
                  "iproute",
                  "iputils",
                  "openssh-clients",
                  "procps-ng",
                  "rootfiles",
                  "passwd",
                  "policycoreutils",
                  "policycoreutils-python-utils",
                  "selinux-policy-targeted",
                  "setools-console",
                  "less",
                  "tar",
                  "ima-evm-utils",
                  "shim-x64",
	            	  "ostree",
                  "microcode_ctl",
                  "iwl1000-firmware",
                  "iwl100-firmware",
                  "iwl105-firmware",
                  "iwl135-firmware",
                  "iwl2000-firmware",
                  "iwl2030-firmware",
                  "iwl3160-firmware",
                  "iwl5000-firmware",
                  "iwl5150-firmware",
                  "iwl6000-firmware",
                  "iwl6050-firmware",
                  "iwl7260-firmware"
                ]
              }
            }
          }
        },
	      {
          "type": "org.osbuild.systemd",
          "options": {
            "enabled_services": [
              "coreos-installer"
            ]
          }
        },
        {
          "type": "org.osbuild.dracut",
          "options": {
            "kernel": [
              "4.18.0-308.el8.x86_64"
            ],
            "add_modules": [
              "qemu",
              "qemu-net",
              "fs-lib",
              "network",
              "rdcore",
              "url-lib",
              "crypt-gpg",
              "pollcdrom",
              "dmsquash-live"
            ]
          }
        }
      ]
    },
    {
      "name": "efiboot-tree",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.grub.iso",
          "options": {
            "product": {
              "name": "redhat",
              "version": "8.5"
            },
            "isolabel": {
              "mpp-format-string": "{isolabel}"
            },
            "kernel": "4.18.0-308.el8.x86_64",
            "kernel_opts": {
              "mpp-format-string": "rd.neednet=1 console=tty0 console=ttyS0 edge.liveiso={isolabel} coreos.inst.install_dev=/dev/vda coreos.inst.image_file=/run/media/iso/disk.img.xz coreos.inst.insecure"
            },
            "efi": {
              "architectures": [
                "IA32",
                "X64"
              ],
              "vendor": "redhat"
            }
          }
        }
      ]
    },
    {
      "name": "bootiso-tree",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.copy",
          "inputs": {
            "img": {
              "type": "org.osbuild.files",
              "origin": "org.osbuild.pipeline",
              "references": {
                "name:image-xz": {
                  "file": "disk.img.xz"
                }
              }
            }
          },
          "options": {
            "paths": [
              {
                "from": "input://img/disk.img.xz",
                "to": "tree:///disk.img.xz"
              }
            ]
          }
        },
        {
          "type": "org.osbuild.mkdir",
          "options": {
            "paths": [
              {
                "path": "images"
              },
              {
                "path": "images/pxeboot"
              }
            ]
          }
        },
        {
          "type": "org.osbuild.truncate",
          "options": {
            "filename": "images/efiboot.img",
            "size": "20MB"
          }
        },
        {
          "type": "org.osbuild.mkfs.fat",
          "devices": {
            "device": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "images/efiboot.img"
              }
            }
          },
          "options": {
            "label": "COI",
            "volid": "7B7795E7"
          }
        },
        {
          "type": "org.osbuild.copy",
          "inputs": {
            "tree": {
              "type": "org.osbuild.tree",
              "origin": "org.osbuild.pipeline",
              "references": [
                "name:efiboot-tree"
              ]
            }
          },
          "options": {
            "paths": [
              {
                "from": "input://tree/",
                "to": "mount://efi/"
              }
            ]
          },
          "devices": {
            "efi": {
              "type": "org.osbuild.loopback",
              "options": {
                "filename": "images/efiboot.img"
              }
            }
          },
          "mounts": {
            "efi": {
              "type": "org.osbuild.fat",
              "source": "efi",
              "target": "/"
            }
          }
        },
        {
          "type": "org.osbuild.copy",
          "inputs": {
            "base": {
              "type": "org.osbuild.tree",
              "origin": "org.osbuild.pipeline",
              "references": [
                "name:base"
              ]
            }
          },
          "options": {
            "paths": [
              {
                "from": "input://base/boot/vmlinuz-4.18.0-308.el8.x86_64",
                "to": "tree:///images/pxeboot/vmlinuz"
              },
              {
                "from": "input://base/boot/initramfs-4.18.0-308.el8.x86_64.img",
                "to": "tree:///images/pxeboot/initrd.img"
              }
            ]
          }
        },
        {
          "type": "org.osbuild.copy",
          "inputs": {
            "base": {
              "type": "org.osbuild.tree",
              "origin": "org.osbuild.pipeline",
              "references": [
                "name:efiboot-tree"
              ]
            }
          },
          "options": {
            "paths": [
              {
                "from": "input://base/EFI",
                "to": "tree:///"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "bootiso",
      "build": "name:build",
      "stages": [
        {
          "type": "org.osbuild.xorrisofs",
          "inputs": {
            "tree": {
              "type": "org.osbuild.tree",
              "origin": "org.osbuild.pipeline",
              "references": [
                "name:bootiso-tree"
              ]
            }
          },
          "options": {
            "filename": "rhedge.iso",
            "volid": "RHEL-8.5-X86_64",
            "efi": "images/efiboot.img"
          }
        },
        {
          "type": "org.osbuild.implantisomd5",
          "options": {
            "filename": "rhedge.iso"
          }
        }
      ]
    }
  ]
}
